!function(l){"use strict";var i=i||{};i.init=function(){i.$loadMore=jQuery(".JS-Donor-LoadMore"),i.$form=jQuery(".JS-Donor-Form"),i.$content=jQuery(".JS-Donor-Content"),i.$searchInput=jQuery(".JS-Donor-Search"),i.$searchBtn=jQuery(".JS-Donor-SearchBtn"),i.$taxonomyInput=jQuery(".JS-Donor-Taxonomy"),i.$viewAll=jQuery(".JS-Donor-ViewAll"),i.$term=jQuery(".JS-Donor-Term"),this.preventFormSubmit(),this.launchController(),this.onLoadMore(),this.onSearchBtn(),this.onViewAll(),this.onSingleTerm(),this.viewAllState(),this.autoCompleteSearch()},i.preventFormSubmit=function(){i.$form.on("submit",function(e){e.preventDefault(),i.$searchBtn.trigger("click")})},i.launchController=function(){var e=i.$taxonomyInput.map(function(){return l(this).val()}).get();if(""!==e&&l.each(e,function(e,t){var a=t.split(",");l.each(a,function(e,t){var a=i.$form.find("[data-slug='"+t+"']");a.length&&a.addClass("active")})}),""!==i.$searchInput.val()||""!==e){i.$content.empty();var t=i.collectData();i.sendQuery(t)}},i.filterState=function(e){var t=location.protocol+"//"+location.host+location.pathname,a={};0<e.locations.length&&(a.locations=e.locations),0<e.categories.length&&(a.categories=e.categories),t=t+"?"+l.param(a),window.history.pushState("{}",document.title,t)},i.collectData=function(){var a={},e=i.$form.serializeArray();return l.each(e,function(e,t){a[t.name]=t.value}),a.page=i.$loadMore.data("page"),a.nonce=global.nonce,a.action="donor_action",a},i.sendQuery=function(e){l.ajax({type:"post",url:global.ajaxurl,data:e,dataType:"json",beforeSend:function(){i.filterState(e)},success:function(e){e.success&&(0<e.data.html.length&&i.addContent(e.data.html),i.loadMoreState(e.data.max_num_pages),i.btnState(i.$searchBtn,"on"),i.$term.prop("disabled",!1))}})},i.onLoadMore=function(){i.$loadMore.length&&i.$loadMore.on("click",function(e){e.preventDefault(),jQuery(this).addClass("active"),jQuery(this).prop("disabled",!0);var t=i.$loadMore.data("page");i.$loadMore.data("page",t+1);var a=i.collectData();i.sendQuery(a)})},i.loadMoreState=function(e){i.$loadMore.removeClass("active"),i.$loadMore.data("page")<e?(i.$loadMore.prop("disabled",!1),i.$loadMore.show()):i.$loadMore.hide()},i.addContent=function(e){i.$content.append(e)},i.onSearchInput=function(){var e=null;i.$searchInput.on("keyup",function(){null!=e&&clearTimeout(e),e=setTimeout(function(){i.$loadMore.data("page",1),i.$content.empty();var e=i.collectData();i.sendQuery(e)},1e3)})},i.onSearchBtn=function(){i.$searchBtn.length&&i.$searchBtn.on("click",function(e){e.preventDefault(),i.btnState(i.$searchBtn,"off"),i.$loadMore.data("page",1),i.$content.empty();var t=i.collectData();i.sendQuery(t)})},i.btnState=function(e,t){"on"===t?(e.removeClass("active"),e.prop("disabled",!1)):"off"===t&&(e.addClass("active"),e.prop("disabled",!0))},i.onViewAll=function(){i.$viewAll.length&&i.$viewAll.on("click",function(e){e.preventDefault();var t=jQuery(this).data("taxonomy");i.$term.filter("[data-taxonomy='"+t+"']").removeClass("active"),i.$taxonomyInput.filter("[name='"+t+"']").val(""),i.$loadMore.data("page",1),i.$searchInput.val(""),jQuery(this).prop("disabled",!0).removeClass("active"),i.$content.empty();var a=i.collectData();i.sendQuery(a)})},i.viewAllState=function(){if(i.$viewAll.length){var e=i.$viewAll.map(function(){return jQuery(this).data("taxonomy")}).get();""!==e&&l.each(e,function(e,t){var a=i.$term.filter(".active[data-taxonomy='"+t+"']"),o=i.$viewAll.filter("[data-taxonomy='"+t+"']");a.length?o.addClass("active").prop("disabled",!1):o.removeClass("active").prop("disabled",!0)})}},i.onTerm=function(){i.$term.length&&i.$term.on("click",function(e){e.preventDefault(),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active");var t=jQuery(this).data("taxonomy"),a=i.$taxonomyInput.filter("input[name='"+t+"']"),o=i.$term.filter(".active[data-taxonomy='"+t+"']"),n="";o.each(function(e){n=0===e?l(this).data("slug"):n+","+l(this).data("slug")}),a.val(n),i.$loadMore.data("page",1),i.$term.prop("disabled",!0),i.$content.empty();var r=i.collectData();i.sendQuery(r),i.viewAllState()})},i.onSingleTerm=function(){i.$term.length&&i.$term.on("click",function(e){e.preventDefault();var t=jQuery(this).data("taxonomy"),a=i.$term.filter(".active[data-taxonomy='"+t+"']"),o=i.$taxonomyInput.filter("input[name='"+t+"']");jQuery(this).hasClass("active")?(a.removeClass("active"),o.val("")):(a.removeClass("active"),jQuery(this).addClass("active"),o.val(l(this).data("slug"))),i.$loadMore.data("page",1),i.$term.prop("disabled",!0),i.$content.empty();var n=i.collectData();i.sendQuery(n),i.viewAllState()})},i.autoCompleteSearch=function(){var a;i.$searchInput.autoComplete({minChars:2,onSelect:function(e,t,a){a.length&&jQuery(this).val(a),i.$searchBtn.trigger("click")},source:function(e,t){try{a.abort()}catch(e){}a=jQuery.post(global.ajaxurl,{search:e,action:"donor_search",nonce:global.nonce},function(e){t(e.data)})}})},l(function(){i.init()}),l(function(){jQuery(".JS-Collapse").each(function(){var e=jQuery(this),t=e.next(".collapse");e.find(".JS-Collapse-Text").on("click",function(){t.collapse("toggle")}),t.on("show.bs.collapse",function(){e.removeClass("collapsed")}),t.on("hide.bs.collapse",function(){e.addClass("collapsed")})})}),l(function(){l(".JS-Hover").mouseenter(function(){l(this).addClass("hovered")}).mouseleave(function(){l(this).removeClass("hovered")})})}(jQuery);