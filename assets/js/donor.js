!function(r){"use strict";var i=i||{};i.init=function(){i.$loadMore=jQuery(".JS-Donor-LoadMore"),i.$form=jQuery(".JS-Donor-Form"),i.$content=jQuery(".JS-Donor-Content"),i.$searchInput=jQuery(".JS-Donor-Search"),i.$searchBtn=jQuery(".JS-Donor-SearchBtn"),i.$taxonomyInput=jQuery(".JS-Donor-Taxonomy"),i.$viewAll=jQuery(".JS-Donor-ViewAll"),i.$term=jQuery(".JS-Donor-Term"),this.preventFormSubmit(),this.launchController(),this.onLoadMore(),this.onSearchBtn(),this.onViewAll(),this.onSingleTerm(),this.viewAllState(),this.autoCompleteSearch(),this.initGoogleMap()},i.preventFormSubmit=function(){i.$form.on("submit",function(e){e.preventDefault(),i.$searchBtn.trigger("click")})},i.launchController=function(){var e,t=i.$taxonomyInput.map(function(){return r(this).val()}).get();""!==t&&r.each(t,function(e,t){var a=t.split(",");r.each(a,function(e,t){var a=i.$form.find("[data-slug='"+t+"']");a.length&&a.addClass("active")})}),""===i.$searchInput.val()&&""===t||(i.$content.empty(),e=i.collectData(),i.sendQuery(e))},i.filterState=function(e){var t=location.protocol+"//"+location.host+location.pathname,a={};0<e.locations.length&&(a.locations=e.locations),0<e.categories.length&&(a.categories=e.categories),t=t+"?"+r.param(a),window.history.pushState("{}",document.title,t)},i.collectData=function(){var a={},e=i.$form.serializeArray();return r.each(e,function(e,t){a[t.name]=t.value}),a.page=i.$loadMore.data("page"),a.nonce=global.nonce,a.action="donor_action",a},i.sendQuery=function(e){r.ajax({type:"post",url:global.ajaxurl,data:e,dataType:"json",beforeSend:function(){i.filterState(e)},success:function(e){e.success&&(0<e.data.html.length&&i.addContent(e.data.html),i.loadMoreState(e.data.max_num_pages),i.btnState(i.$searchBtn,"on"),i.$term.prop("disabled",!1))}})},i.onLoadMore=function(){i.$loadMore.length&&i.$loadMore.on("click",function(e){e.preventDefault(),jQuery(this).addClass("active"),jQuery(this).prop("disabled",!0);var t=i.$loadMore.data("page");i.$loadMore.data("page",t+1);var a=i.collectData();i.sendQuery(a)})},i.loadMoreState=function(e){i.$loadMore.removeClass("active"),i.$loadMore.data("page")<e?(i.$loadMore.prop("disabled",!1),i.$loadMore.show()):i.$loadMore.hide()},i.addContent=function(e){i.$content.append(e)},i.onSearchInput=function(){var e=null;i.$searchInput.on("keyup",function(){null!=e&&clearTimeout(e),e=setTimeout(function(){i.$loadMore.data("page",1),i.$content.empty();var e=i.collectData();i.sendQuery(e)},1e3)})},i.onSearchBtn=function(){i.$searchBtn.length&&i.$searchBtn.on("click",function(e){e.preventDefault(),i.btnState(i.$searchBtn,"off"),i.$loadMore.data("page",1),i.$content.empty();var t=i.collectData();i.sendQuery(t)})},i.btnState=function(e,t){"on"===t?(e.removeClass("active"),e.prop("disabled",!1)):"off"===t&&(e.addClass("active"),e.prop("disabled",!0))},i.onViewAll=function(){i.$viewAll.length&&i.$viewAll.on("click",function(e){e.preventDefault();var t=jQuery(this).data("taxonomy");i.$term.filter("[data-taxonomy='"+t+"']").removeClass("active"),i.$taxonomyInput.filter("[name='"+t+"']").val(""),i.$loadMore.data("page",1),i.$searchInput.val(""),i.$viewAll.filter("[data-taxonomy='"+t+"']").prop("disabled",!0).removeClass("active"),i.$content.empty();var a=i.collectData();i.sendQuery(a)})},i.viewAllState=function(){var e;!i.$viewAll.length||""!==(e=i.$viewAll.map(function(){return jQuery(this).data("taxonomy")}).get())&&r.each(e,function(e,t){var a=i.$term.filter(".active[data-taxonomy='"+t+"']"),o=i.$viewAll.filter("[data-taxonomy='"+t+"']");a.length?o.addClass("active").prop("disabled",!1):o.removeClass("active").prop("disabled",!0)})},i.onTerm=function(){i.$term.length&&i.$term.on("click",function(e){e.preventDefault(),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active");var t=jQuery(this).data("taxonomy"),a=i.$taxonomyInput.filter("input[name='"+t+"']"),o=i.$term.filter(".active[data-taxonomy='"+t+"']"),l="";o.each(function(e){l=0===e?r(this).data("slug"):l+","+r(this).data("slug")}),a.val(l),i.$loadMore.data("page",1),i.$term.prop("disabled",!0),i.$content.empty();var n=i.collectData();i.sendQuery(n),i.viewAllState()})},i.onSingleTerm=function(){i.$term.length&&i.$term.on("click",function(e){e.preventDefault();var t=jQuery(this).data("taxonomy"),a=i.$term.filter(".active[data-taxonomy='"+t+"']"),o=i.$taxonomyInput.filter("input[name='"+t+"']");jQuery(this).hasClass("active")?(a.removeClass("active"),o.val("")):(a.removeClass("active"),jQuery(this).addClass("active"),o.val(r(this).data("slug"))),i.$loadMore.data("page",1),i.$term.prop("disabled",!0),i.$content.empty();var l=i.collectData();i.sendQuery(l),i.viewAllState()})},i.autoCompleteSearch=function(){var a;i.$searchInput.autoComplete({minChars:2,onSelect:function(e,t,a){a.length&&jQuery(this).val(a),i.$searchBtn.trigger("click")},source:function(e,t){try{a.abort()}catch(e){}a=jQuery.post(global.ajaxurl,{search:e,action:"donor_search",nonce:global.nonce},function(e){t(e.data)})}})},i.initGoogleMap=function(){var e,t,a,o;0!==jQuery(".JS-Donor-Map").length&&"0"!==global.google_map_status&&(e={zoom:7,center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP]},styles:[{elementType:"geometry",stylers:[{color:"#ab7942"}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#84bc00"}]},{featureType:"landscape.natural.landcover",elementType:"geometry",stylers:[{color:"#84bc00"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#007395"},{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#6f9ba5"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#023e58"},{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#3C7680"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#304a7d"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#98a5be"},{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#a8d440"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#255763"},{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#b0d5ce"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#023e58"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#283d6a"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#3a4762"},{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#007395"}]},{featureType:"water",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#ebebeb"}]}]},(t=new google.maps.Map(jQuery(".JS-Donor-Map")[0],e)).markers=[],a=jQuery(document).find(".js-marker"),o=0,a.each(function(){i.initMapMarker(r(this),t,o),o++}),i.centerMap(t))},i.initMapMarker=function(e,t,a){var o=new google.maps.LatLng(e.attr("data-lat"),e.attr("data-lng")),l="https://mt.googleapis.com/vt/icon/name=icons/spotlight/spotlight-poi.png",n="https://mt.google.com/vt/icon?color=ff004C13&name=icons/spotlight/spotlight-waypoint-blue.png",r=l;e.hasClass("active")&&(r=n);var i,s=new google.maps.Marker({position:o,map:t,slug:e.data("slug"),icon:r});t.markers.push(s),e.html()&&(i=new google.maps.InfoWindow({content:e.find(".js-marker-tooltip").html()}),jQuery(".JS-Donor-Term[data-slug='"+s.slug+"']").on("click",function(){for(var e=0;e<t.markers.length;e++)t.markers[e].setIcon(l);s.setIcon(n)}),jQuery('.JS-Donor-ViewAll[data-taxonomy="locations"]').on("click",function(){for(var e=0;e<t.markers.length;e++)t.markers[e].setIcon(l)}),google.maps.event.addListener(s,"click",function(){for(var e=0;e<t.markers.length;e++)t.markers[e].setIcon(l);this.setIcon(n),jQuery('.JS-Donor-Term[data-slug="'+s.slug+'"]').trigger("click")}),s.addListener("mouseover",function(){i.open(t,this)}),s.addListener("mouseout",function(){i.close(t,this)}))},i.centerMap=function(e){var t,o=new google.maps.LatLngBounds;r.each(e.markers,function(e,t){var a=new google.maps.LatLng(t.position.lat(),t.position.lng());o.extend(a)}),1==e.markers.length?(e.setCenter(o.getCenter()),e.setZoom(16)):(e.fitBounds(o),t=google.maps.event.addListener(e,"idle",function(){e.setZoom(3),google.maps.event.removeListener(t)}))},r(function(){i.init()}),r(function(){jQuery(".JS-Collapse").each(function(){var e=jQuery(this),t=e.next(".collapse");e.find(".JS-Collapse-Toggle");e.on("click",function(){t.collapse("toggle")}),t.on("show.bs.collapse",function(){e.removeClass("collapsed")}),t.on("hide.bs.collapse",function(){e.addClass("collapsed")})})}),r(function(){r(".JS-Hover").mouseenter(function(){r(this).addClass("hovered")}).mouseleave(function(){r(this).removeClass("hovered")})})}(jQuery);